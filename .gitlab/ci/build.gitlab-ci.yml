cache:
  key: gradle-cache
  paths:
    - .gradle/
    - build/

spotless-formatting-check:
  image: gradle:8.12.1-jdk23
  stage: prerequisites
  script:
    - ./gradlew --no-daemon spotlessCheck
  interruptible: true

unit-test:
  image: gradle:8.12.1-jdk23
  stage: prerequisites
  script:
    - ./gradlew --no-daemon test
  interruptible: true

compile-and-build-jar:
  image: gradle:8.12.1-jdk23
  stage: build
  script:
    - ./gradlew --no-daemon clean build -x spotlessCheck test
  interruptible: true

docker-image-build:
  stage: dockerize
  image: quay.io/buildah/stable
  variables:
    STORAGE_DRIVER: vfs
    BUILDAH_FORMAT: docker
  before_script:
    - echo "$CI_REGISTRY_PASSWORD" | buildah login -u "$CI_REGISTRY_USER" --password-stdin $CI_REGISTRY
  script:
    - buildah build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHORT_SHA
    - buildah push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHORT_SHA
  interruptible: true
